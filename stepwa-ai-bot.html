
   
 

    <section>
<style>
    /* AI Chat Icon */
        #ai-chat-icon {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #7c0a0a 0%, rgba(15, 25, 87, 0.95) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(124, 10, 10, 0.4);
            transition: all 0.3s ease;
            z-index: 9999;
            animation: pulse 2s infinite;
        }

        #ai-chat-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(124, 10, 10, 0.6);
        }

        #ai-chat-icon i {
            font-size: 32px;
            color: white;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 4px 20px rgba(124, 10, 10, 0.4); }
            50% { box-shadow: 0 4px 30px rgba(124, 10, 10, 0.7); }
        }

        /* Speech Bubbles */
        #ai-speech-bubbles {
            position: fixed;
            bottom: 110px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 9998;
        }

        .ai-speech-bubble {
            background: white;
            color: #333;
            padding: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            font-size: 13px;
            font-weight: 500;
            max-width: 240px;
            position: relative;
            opacity: 0;
            transform: translateX(20px);
            animation: bubbleSlideIn 0.5s ease forwards;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ai-speech-bubble:hover {
            transform: translateX(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .ai-speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -6px;
            right: 20px;
            width: 12px;
            height: 12px;
            background: white;
            transform: rotate(45deg);
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            z-index: -1;
        }

        .ai-speech-bubble:nth-child(1) { animation-delay: 0.5s; }
        .ai-speech-bubble:nth-child(2) { animation-delay: 2.5s; }
        .ai-speech-bubble:nth-child(3) { animation-delay: 4.5s; }
        .ai-speech-bubble.hidden { display: none; }

        @keyframes bubbleSlideIn {
            to { opacity: 1; transform: translateX(0); }
        }

        /* Chat Window */
        #ai-chat-window {
            position: fixed;
            bottom: 110px;
            right: 30px;
            width: 400px;
            max-width: calc(100vw - 60px);
            height: 600px;
            max-height: calc(100vh - 150px);
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 9998;
            animation: slideUp 0.3s ease;
        }

        #ai-chat-window.active { display: flex; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Chat Header */
        #ai-chat-header {
            background: linear-gradient(135deg, #7c0a0a 0%, rgba(15, 25, 87, 0.95) 100%);
            color: white;
            padding: 18px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #ai-chat-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        #ai-bot-avatar {
            width: 45px;
            height: 45px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: #7c0a0a;
        }

        #ai-bot-info {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        #ai-bot-name {
            font-weight: 600;
            font-size: 16px;
        }

        #ai-bot-status {
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            opacity: 0.95;
        }

        #ai-online-dot {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        #ai-header-actions {
            display: flex;
            gap: 8px;
        }

        .ai-header-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 6px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .ai-header-btn:hover { background: rgba(255, 255, 255, 0.2); }

        /* Messages */
        #ai-chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f7f9fc;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        #ai-chat-messages::-webkit-scrollbar { width: 6px; }
        #ai-chat-messages::-webkit-scrollbar-track { background: #f1f1f1; }
        #ai-chat-messages::-webkit-scrollbar-thumb { background: #7c0a0a; border-radius: 3px; }

        .ai-message {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-width: 85%;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ai-message.user { align-self: flex-end; }
        .ai-message.bot { align-self: flex-start; }

        .ai-message-content {
            padding: 12px 16px;
            border-radius: 12px;
            line-height: 1.6;
            font-size: 14px;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .ai-message.user .ai-message-content {
            background: linear-gradient(135deg, #7c0a0a 0%, rgba(15, 25, 87, 0.95) 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .ai-message.bot .ai-message-content {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 4px;
        }

        .ai-message-label {
            font-size: 11px;
            color: #999;
            font-weight: 500;
            padding: 0 4px;
        }

        .ai-typing-indicator {
            display: none;
            align-items: center;
            gap: 4px;
            padding: 12px 16px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            max-width: 70px;
            align-self: flex-start;
        }

        .ai-typing-indicator.active { display: flex; }

        .ai-typing-dot {
            width: 8px;
            height: 8px;
            background: #7c0a0a;
            border-radius: 50%;
            animation: typingDot 1.4s infinite;
        }

        .ai-typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .ai-typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingDot {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.7; }
            30% { transform: translateY(-10px); opacity: 1; }
        }

        /* Input */
        #ai-chat-input-area {
            padding: 16px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        #ai-user-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 24px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
            font-family: inherit;
        }

        #ai-user-input:focus { border-color: #7c0a0a; }
        #ai-user-input:disabled { background: #f5f5f5; cursor: not-allowed; }

        #ai-send-btn {
            background: linear-gradient(135deg, #7c0a0a 0%, rgba(15, 25, 87, 0.95) 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        #ai-send-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(124, 10, 10, 0.4);
        }

        #ai-send-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .ai-welcome {
            background: white;
            padding: 18px;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            text-align: center;
        }

        .ai-welcome h3 {
            margin: 0 0 10px 0;
            color: #7c0a0a;
            font-size: 17px;
        }

        .ai-welcome p {
            margin: 0;
            color: #666;
            font-size: 13.5px;
            line-height: 1.6;
        }

        .ai-error-message {
            background: #fee;
            color: #c33;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 13px;
            border-left: 3px solid #c33;
            line-height: 1.5;
        }

        .ai-info-message {
            background: #e3f2fd;
            color: #1565c0;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 13px;
            border-left: 3px solid #1565c0;
            line-height: 1.5;
        }

        /* Chat History Modal */
        #ai-history-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }

        #ai-history-modal.active { display: flex; }

        .ai-history-content {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            animation: slideUp 0.3s ease;
        }

        .ai-history-header {
            background: linear-gradient(135deg, #7c0a0a 0%, rgba(15, 25, 87, 0.95) 100%);
            color: white;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-history-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .ai-history-list {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .ai-history-item {
            background: #f7f9fc;
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e0e0e0;
        }

        .ai-history-item:hover {
            background: #eef2f7;
            border-color: #7c0a0a;
            transform: translateX(5px);
        }

        .ai-history-item-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
            font-size: 14px;
        }

        .ai-history-item-preview {
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .ai-history-item-date {
            font-size: 11px;
            color: #999;
        }

        .ai-empty-history {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .ai-empty-history i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Mobile */
        @media (max-width: 480px) {
            #ai-chat-window {
                width: calc(100vw - 20px);
                height: calc(100vh - 100px);
                right: 10px;
                bottom: 90px;
            }
            #ai-chat-icon { 
                right: 20px; 
                bottom: 20px;
                width: 60px;
                height: 60px;
            }
            #ai-chat-icon i { font-size: 28px; }
            #ai-speech-bubbles { right: 20px; bottom: 90px; }
            .ai-speech-bubble { max-width: calc(100vw - 100px); font-size: 12px; }
        }
    </style>

<!-- Speech Bubbles -->
<div id="ai-speech-bubbles">
    <div class="ai-speech-bubble" onclick="sendBubbleMessage('What courses do you offer?')">
        <i class="fa-solid fa-graduation-cap"></i> What courses do you offer?
    </div>
    <div class="ai-speech-bubble" onclick="sendBubbleMessage('How can I enroll?')">
        <i class="fa-solid fa-user-plus"></i> How can I enroll?
    </div>
    <div class="ai-speech-bubble" onclick="sendBubbleMessage('Tell me about pricing')">
        <i class="fa-solid fa-tag"></i> Tell me about pricing
    </div>
</div>

<!-- Chat Icon -->
<div id="ai-chat-icon" onclick="toggleAIChat()" title="Chat with AI Assistant">
    <i class="fa-solid fa-comments"></i>
</div>

<!-- Chat Window -->
<div id="ai-chat-window">
    <div id="ai-chat-header">
        <div id="ai-chat-header-left">
            <div id="ai-bot-avatar"><i class="fa-solid fa-robot"></i></div>
            <div id="ai-bot-info">
                <div id="ai-bot-name">Stepway Assistant</div>
                <div id="ai-bot-status">
                    <span id="ai-online-dot"></span>
                    <span>Online & Ready</span>
                </div>
            </div>
        </div>
        <div id="ai-header-actions">
            <button class="ai-header-btn" onclick="showChatHistory()" title="View Chat History">
                <i class="fa-solid fa-clock-rotate-left"></i>
            </button>
            <button class="ai-header-btn" onclick="startNewChat()" title="Start New Chat">
                <i class="fa-solid fa-plus"></i>
            </button>
            <button class="ai-header-btn" onclick="toggleAIChat()" title="Close">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
    </div>
    
    <div id="ai-chat-messages">
        <div class="ai-welcome">
            <h3><i class="fa-solid fa-hand-wave"></i> Welcome to Stepway Technologies!</h3>
            <p>I'm your AI assistant, here to help you with courses, enrollment, pricing, and any questions about our programs. How can I help you today?</p>
        </div>
        <div class="ai-typing-indicator" id="ai-typing-indicator">
            <div class="ai-typing-dot"></div>
            <div class="ai-typing-dot"></div>
            <div class="ai-typing-dot"></div>
        </div>
    </div>
    
    <div id="ai-chat-input-area">
        <input type="text" id="ai-user-input" placeholder="Type your message..." onkeypress="handleKeyPress(event)">
        <button id="ai-send-btn" onclick="sendMessage()">
            <i class="fa-solid fa-paper-plane"></i>
        </button>
    </div>
</div>

<!-- Chat History Modal -->
<div id="ai-history-modal">
    <div class="ai-history-content">
        <div class="ai-history-header">
            <h3><i class="fa-solid fa-clock-rotate-left"></i> Chat History</h3>
            <button class="ai-header-btn" onclick="closeChatHistory()">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <div class="ai-history-list" id="ai-history-list"></div>
    </div>
</div>

<script>
// ============================================
//  CONFIGURATION - EASY TO UPDATE
// ============================================

const CONFIG = {
    // Update this when you get your real domain
    websiteUrl: 'https://stepway-teachnologies-company.netlify.app',
    
    // Your Gemini API key (get free from: https://makersuite.google.com/app/apikey)
   geminiApiKey: 'AIzaSyB6A7zEpdDj2NFck-ULND9DnWQkhCBMQ4w',
    
    // Company info
    companyName: 'Stepway Technologies',
    contactEmail: 'info@stepwaytechnology.com',
    
    // Daily request limit (Gemini free tier: 15-60/day)
    dailyLimit: 50,
    
    // Limit reached message
    limitMessage: 'Chat limit reached today. Try again tomorrow or email us at info@stepwaytechnology.com'
};

// Website knowledge base (auto-extracted from your site)
const SITE_KNOWLEDGE = {
    courses: [
        { category: 'Data Science', count: 3 },
        { category: 'Cybersecurity', count: 3 },
        { category: 'Climate Science', count: 3 },
        { category: 'Intelligent Systems', count: 3 },
        { category: 'Computer Foundations', count: 3 },
        { category: 'UI/UX Design', count: 3 }
    ],
    features: [
        'Expert instructors with industry experience',
        'Hands-on projects and real-world applications',
        'Flexible learning schedules',
        'Industry-recognized certificates',
        'Career support and guidance'
    ],
    about: 'Stepway Technologies offers comprehensive technology training across various domains including Data Science, Cybersecurity, Climate Science, Intelligent Systems, Computer Foundations, and UI/UX Design.'
};

// Chat storage
let chatHistory = [];
let currentChat = [];
let chatSessions = JSON.parse(localStorage.getItem('stepway_chat_sessions') || '[]');
let requestCount = parseInt(localStorage.getItem('stepway_request_count') || '0');
let lastResetDate = localStorage.getItem('stepway_last_reset') || new Date().toDateString();

// Reset counter daily
if (lastResetDate !== new Date().toDateString()) {
    requestCount = 0;
    localStorage.setItem('stepway_request_count', '0');
    localStorage.setItem('stepway_last_reset', new Date().toDateString());
}

// ============================================
//  AI RESPONSE GENERATION
// ============================================

async function getAIResponse(userMessage) {
    // Check daily limit
    if (requestCount >= CONFIG.dailyLimit) {
        return CONFIG.limitMessage;
    }

    // Build context from chat history
    const conversationContext = currentChat.slice(-6).map(msg => 
        `${msg.type === 'user' ? 'User' : 'Assistant'}: ${msg.content}`
    ).join('\n');

    // Build prompt with site knowledge
    const prompt = `You are Stepway Assistant, a helpful and professional AI assistant for ${CONFIG.companyName}.

IMPORTANT PERSONALITY GUIDELINES:
- Be professional yet friendly and warm
- Use occasional emojis ONLY when showing emotions (happy üòä, excited üéâ, thinking ü§î)
- DO NOT use emojis in every sentence - use them sparingly
- Keep responses clear and concise
- Be accurate and helpful
- You can joke or tease ONLY when the user specifically asks for it or when the conversation is very casual

WEBSITE INFORMATION:
Courses: ${SITE_KNOWLEDGE.courses.map(c => `${c.category} (${c.count} courses)`).join(', ')}
Features: ${SITE_KNOWLEDGE.features.join(', ')}
About: ${SITE_KNOWLEDGE.about}
Contact: ${CONFIG.contactEmail}

PREVIOUS CONVERSATION:
${conversationContext}

USER QUESTION: ${userMessage}

Provide a helpful, accurate response based on the website information. If asked about something not covered, politely say you can help with courses, enrollment, pricing, or direct them to ${CONFIG.contactEmail}.`;

    try {
        // Check if API key is configured
        if (CONFIG.geminiApiKey === 'AIzaSyB6A7zEpdDj2NFck-ULND9DnWQkhCBMQ4w') {
            return `I'd love to help, but I need to be connected to my AI brain first! üß†\n\nTo activate me, the website owner needs to:\n1. Get a free API key from Google AI Studio\n2. Add it to the configuration\n\nIn the meantime, here's what I know:\n‚Ä¢ We offer courses in: ${SITE_KNOWLEDGE.courses.map(c => c.category).join(', ')}\n‚Ä¢ Contact us at: ${CONFIG.contactEmail}\n\nWhat would you like to know about our courses?`;
        }

        // Call Gemini API
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${CONFIG.geminiApiKey}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{
                    parts: [{ text: prompt }]
                }],
                generationConfig: {
                    temperature: 0.7,
                    maxOutputTokens: 500
                }
            })
        });

        const data = await response.json();
        
        if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
            requestCount++;
            localStorage.setItem('stepway_request_count', requestCount.toString());
            return data.candidates[0].content.parts[0].text;
        } else {
            throw new Error('Invalid API response');
        }
    } catch (error) {
        console.error('AI Error:', error);
        return getFallbackResponse(userMessage);
    }
}

// Fallback responses when API fails or not configured
function getFallbackResponse(question) {
    const q = question.toLowerCase();
    
    if (q.includes('course') || q.includes('program') || q.includes('learn')) {
        return `We offer courses in these exciting fields:\n\n${SITE_KNOWLEDGE.courses.map(c => `‚Ä¢ ${c.category} (${c.count} courses)`).join('\n')}\n\nWhich area interests you most? I'd be happy to tell you more! üòä`;
    }
    
    if (q.includes('price') || q.includes('cost') || q.includes('fee')) {
        return `Great question! Course pricing varies by program. For specific pricing details, please contact us at ${CONFIG.contactEmail} or let me know which course you're interested in.`;
    }
    
    if (q.includes('enroll') || q.includes('register') || q.includes('sign up')) {
        return `Enrolling is easy! You can:\n1. Choose your course\n2. Fill out the registration form\n3. Complete payment\n\nNeed help with any step? Just ask!`;
    }
    
    if (q.includes('contact') || q.includes('email') || q.includes('reach')) {
        return `You can reach us at:\nüìß ${CONFIG.contactEmail}\n\nWe typically respond within 24 hours. How else can I help you today?`;
    }
    
    if (q.includes('hello') || q.includes('hi') || q.includes('hey')) {
        return `Hello! üëã Welcome to ${CONFIG.companyName}! I'm here to help you explore our courses and answer your questions. What would you like to know?`;
    }
    
    return `I'm here to help with:\n‚Ä¢ Course information\n‚Ä¢ Enrollment process\n‚Ä¢ Pricing details\n‚Ä¢ Contact information\n\nWhat specific information are you looking for? ü§î`;
}

// ============================================
//  CHAT FUNCTIONS
// ============================================

async function sendMessage() {
    const inputField = document.getElementById('ai-user-input');
    const sendBtn = document.getElementById('ai-send-btn');
    const question = inputField.value.trim();
    
    if (!question) return;
    
    inputField.disabled = true;
    sendBtn.disabled = true;
    
    addMessage('user', question);
    currentChat.push({ type: 'user', content: question, timestamp: new Date().toISOString() });
    inputField.value = '';
    
    showTypingIndicator();
    
    await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 700));
    
    const answer = await getAIResponse(question);
    
    hideTypingIndicator();
    addMessage('bot', answer);
    currentChat.push({ type: 'bot', content: answer, timestamp: new Date().toISOString() });
    
    saveChatSession();
    
    inputField.disabled = false;
    sendBtn.disabled = false;
    inputField.focus();
}

function sendBubbleMessage(message) {
    toggleAIChat();
    setTimeout(() => {
        document.getElementById('ai-user-input').value = message;
        sendMessage();
    }, 300);
}

function addMessage(type, content) {
    const messagesContainer = document.getElementById('ai-chat-messages');
    const typingIndicator = document.getElementById('ai-typing-indicator');
    
    const messageDiv = document.createElement('div');
    messageDiv.className = `ai-message ${type}`;
    
    const label = document.createElement('div');
    label.className = 'ai-message-label';
    label.textContent = type === 'user' ? 'You' : 'Assistant';
    
    const contentDiv = document.createElement('div');
    contentDiv.className = 'ai-message-content';
    contentDiv.textContent = content;
    
    messageDiv.appendChild(label);
    messageDiv.appendChild(contentDiv);
    messagesContainer.insertBefore(messageDiv, typingIndicator);
    
    scrollToBottom();
}

function toggleAIChat() {
    const chatWindow = document.getElementById('ai-chat-window');
    const speechBubbles = document.querySelectorAll('.ai-speech-bubble');
    const isActive = chatWindow.classList.toggle('active');
    
    speechBubbles.forEach(bubble => bubble.classList.toggle('hidden', isActive));
    
    if (isActive) {
        document.getElementById('ai-user-input').focus();
    }
}

function handleKeyPress(event) {
    if (event.key === 'Enter') sendMessage();
}

function showTypingIndicator() {
    document.getElementById('ai-typing-indicator').classList.add('active');
    scrollToBottom();
}

function hideTypingIndicator() {
    document.getElementById('ai-typing-indicator').classList.remove('active');
}

function scrollToBottom() {
    const messagesContainer = document.getElementById('ai-chat-messages');
    setTimeout(() => messagesContainer.scrollTop = messagesContainer.scrollHeight, 100);
}

// ============================================
//  CHAT HISTORY & SESSION MANAGEMENT
// ============================================

function saveChatSession() {
    if (currentChat.length === 0) return;
    
    const existingIndex = chatSessions.findIndex(s => s.id === currentChat[0].timestamp);
    
    const session = {
        id: currentChat[0].timestamp,
        title: currentChat[0].content.substring(0, 50) + '...',
        messages: currentChat,
        date: new Date().toLocaleString()
    };
    
    if (existingIndex >= 0) {
        chatSessions[existingIndex] = session;
    } else {
        chatSessions.unshift(session);
    }
    
    // Keep only last 20 sessions
    chatSessions = chatSessions.slice(0, 20);
    localStorage.setItem('stepway_chat_sessions', JSON.stringify(chatSessions));
}

function showChatHistory() {
    const modal = document.getElementById('ai-history-modal');
    const listContainer = document.getElementById('ai-history-list');
    
    if (chatSessions.length === 0) {
        listContainer.innerHTML = `
            <div class="ai-empty-history">
                <i class="fa-solid fa-comments"></i>
                <p>No chat history yet. Start a conversation!</p>
            </div>
        `;
    } else {
        listContainer.innerHTML = chatSessions.map(session => `
            <div class="ai-history-item" onclick="loadChatSession('${session.id}')">
                <div class="ai-history-item-title">${session.title}</div>
                <div class="ai-history-item-preview">${session.messages.length} messages</div>
                <div class="ai-history-item-date"><i class="fa-regular fa-clock"></i> ${session.date}</div>
            </div>
        `).join('');
    }
    
    modal.classList.add('active');
}

function closeChatHistory() {
    document.getElementById('ai-history-modal').classList.remove('active');
}

function loadChatSession(sessionId) {
    const session = chatSessions.find(s => s.id === sessionId);
    if (!session) return;
    
    closeChatHistory();
    
    // Clear current messages
    const messagesContainer = document.getElementById('ai-chat-messages');
    const welcome = messagesContainer.querySelector('.ai-welcome');
    const typing = messagesContainer.querySelector('.ai-typing-indicator');
    messagesContainer.innerHTML = '';
    messagesContainer.appendChild(typing);
    
    // Load session messages
    currentChat = [...session.messages];
    session.messages.forEach(msg => {
        addMessage(msg.type, msg.content);
    });
    
    scrollToBottom();
}

function startNewChat() {
    if (currentChat.length > 0) {
        if (!confirm('Start a new chat? Current conversation will be saved to history.')) {
            return;
        }
        saveChatSession();
    }
    
    // Clear messages
    const messagesContainer = document.getElementById('ai-chat-messages');
    const typing = document.getElementById('ai-typing-indicator');
    messagesContainer.innerHTML = `
        <div class="ai-welcome">
            <h3><i class="fa-solid fa-hand-wave"></i> Welcome to Stepway Technologies!</h3>
            <p>I'm your AI assistant, here to help you with courses, enrollment, pricing, and any questions about our programs. How can I help you today?</p>
        </div>
    `;
    messagesContainer.appendChild(typing);
    
    currentChat = [];
    document.getElementById('ai-user-input').focus();
}

// ============================================
//  INITIALIZATION
// ============================================

// Close modal when clicking outside
document.getElementById('ai-history-modal').addEventListener('click', function(e) {
    if (e.target === this) closeChatHistory();
});

// Auto-save on page unload
window.addEventListener('beforeunload', () => {
    if (currentChat.length > 0) saveChatSession();
});

console.log('‚úÖ Stepway AI Assistant loaded successfully!');
console.log(`üìä Daily requests used: ${requestCount}/${CONFIG.dailyLimit}`);
if (CONFIG.geminiApiKey === 'AIzaSyB6A7zEpdDj2NFck-ULND9DnWQkhCBMQ4w') {
    console.log('‚ö†Ô∏è API key not configured - using fallback responses');
    console.log('Get your free API key: https://makersuite.google.com/app/apikey');
}
</script>

<!--///////////////////////// CORRECT NON-FLAGGING CHATBOT///////////////////// -->


    </section>
